# Gemini Mail Review - Thunderbird 扩展

一个使用 Google Gemini AI 在发送前检查电子邮件的 Thunderbird 扩展。获得有关拼写、语法、语气、清晰度和潜在问题的智能反馈。

[English](README.md) | [日本語](README.ja.md) | [Deutsch](README.de.md) | [Français](README.fr.md) | 简体中文

## 功能

- 🤖 **AI 驱动审查**：使用 Google 的 Gemini Pro 模型分析您的电子邮件
- ✅ **全面检查**：检查拼写、语法、语气、专业性和清晰度
- ⚠️ **问题检测**：识别潜在问题，如缺少附件或不清楚的消息
- 🎯 **易于使用**：只需在撰写窗口中点击扩展图标
- 🔒 **安全**：API 密钥和缓存数据使用 AES-GCM 加密保护并本地存储在 Thunderbird 中
- 📦 **智能缓存**：自动缓存响应以避免对相同电子邮件内容进行冗余 API 调用

## 安装

### 从源代码安装

1. 从 https://github.com/jy-hirasawa/thunderbird-gemini-mail-review-addon/releases/ 下载最新版本
2. 打开 Thunderbird
3. 转到**工具** → **扩展和主题**（或按 `Ctrl+Shift+A`）
4. 点击齿轮图标 ⚙️ 并选择**从文件安装扩展**
5. 导航到扩展目录并选择 `manifest.json` 文件

### 要求

- Thunderbird 102.0 或更高版本
- Google Gemini API 密钥（有免费版本）

## 设置

1. 获取 Gemini API 密钥：
   - 访问 [Google AI Studio](https://makersuite.google.com/app/apikey)
   - 使用您的 Google 账户登录
   - 点击**创建 API 密钥**
   - 复制生成的密钥

2. 配置扩展：
   - 在 Thunderbird 中，转到**工具** → **扩展和主题**
   - 在扩展列表中找到 **Gemini Mail Review**
   - 点击**选项**或**首选项**
   - 粘贴您的 API 密钥
   - （可选）如果要使用不同的 Gemini 模型，请自定义 API 端点 URL
     - 默认：`https://generativelanguage.googleapis.com/v1/models/gemini-2.5-flash:generateContent`
   - （可选）添加自定义提示模板以自定义 Gemini 如何分析您的电子邮件
     - 您可以保存最多 3 个带名称的自定义提示模板
     - 检查电子邮件时，每个模板都可供选择
     - 自定义提示将添加到分析请求之前
     - **多语言支持**：用任何语言编写提示以获得该语言的分析结果
     - 示例（英语）："Review this email for business communication. Check if the language is polite, appropriate for clients, and sufficiently formal. Flag any inappropriate, unnatural, or misleading expressions."
     - 示例（日语）："以下のメール本文が、取引先・顧客など会社宛てのメールとして、敬語や言い回しが適切か、失礼・不自然・誤解を招く表現がないか、ビジネスメールとして十分にフォーマルかを確認してください。問題点があれば、理由とあわせて修正案を提示してください。"
   - （可选）配置缓存保留天数（1-365 天）
     - 默认：7 天
     - 确定缓存分析结果在过期前保留多长时间
   - 点击**保存设置**
   - （可选）点击**测试连接**以验证您的配置是否有效

## 使用方法

1. 像往常一样在 Thunderbird 中撰写电子邮件
2. 发送前，点击撰写窗口工具栏中的 **Gemini Mail Review** 图标
3. 扩展打开模板选择界面：
   - **选择自定义提示模板**：从已保存的模板中选择（模板 1、2 或 3）
   - **编辑自定义提示**：在分析前查看和修改提示
   - 点击**分析电子邮件**开始检查
4. 扩展将分析您的电子邮件并显示结果
   - 如果您已经分析过这封完全相同的电子邮件（相同主题、收件人和正文），缓存的响应将立即显示
   - 显示缓存结果时会出现"📦 显示缓存的响应"指示器
5. 查看 AI 反馈和建议
6. 选择：
   - **从 Gemini 重新请求**：从 API 获取新的分析（仅针对缓存结果或内容更改时显示）
   - **编辑电子邮件**：关闭弹窗并进行更改
   - **仍然发送**：继续发送（电子邮件不会自动发送 - 您仍需点击发送）

### 缓存行为

扩展智能缓存 Gemini 响应以：
- **节省 API 调用**：避免对已分析的电子邮件进行不必要的请求
- **更快的反馈**：重新打开相同电子邮件时显示即时结果
- **智能检测**：自动检测电子邮件内容何时更改并首先显示之前的分析

**缓存如何工作：**
- 每封电子邮件由其主题、收件人和正文内容的唯一哈希值标识
- 每个撰写选项卡跟踪最后分析的内容以检测更改
- 如果再次分析相同的电子邮件，将立即显示缓存的响应
- **如果您编辑电子邮件并再次检查：**
  - 首先显示之前的分析，并显示"⚠️ 电子邮件内容已更改"指示器
  - 出现"从 Gemini 重新请求"按钮以获取更新内容的新分析
  - 这使您可以快速查看之前的反馈，同时决定是否需要新的检查
- 缓存存储最后 50 个电子邮件分析（最旧的条目会自动删除）
- 缓存响应保留可配置的时间段（默认：7 天）并在之后自动过期
- 您可以在设置中自定义缓存保留期（1-365 天）
- 缓存使用 browser.storage.local 本地存储在您的 Thunderbird 配置文件中

## 分析内容

扩展将以下信息发送到 Gemini 进行分析：
- 电子邮件主题行
- 收件人
- 电子邮件正文（纯文本）

AI 检查：
- 拼写和语法错误
- 语气和专业性
- 清晰度和简洁性
- 缺失的信息
- 潜在的问题或顾虑

## 隐私声明

此扩展将您的电子邮件内容发送到 Google 的 Gemini API 进行分析。您的电子邮件根据 [Google 隐私政策](https://policies.google.com/privacy)进行处理。

**安全功能**：
- API 密钥和自定义提示使用 AES-GCM 加密本地存储
- 缓存的电子邮件数据使用特定于电子邮件的密钥加密
- 特定于配置文件的加密可隔离不同 Thunderbird 配置文件之间的数据
- 加密密钥从配置文件 ID 和电子邮件 ID 派生
- 详见 [SECURITY.md](doc/zh_CN/SECURITY.md)

**重要提示**：除非您愿意让 Google 的 AI 服务处理，否则不要对高度敏感或机密的电子邮件使用此扩展。

## 开发

### 项目结构

```
.
├── manifest.json       # 扩展清单
├── background.js       # 后台脚本
├── popup.html         # 主弹窗界面
├── popup.css          # 弹窗样式
├── popup.js           # 弹窗逻辑和 API 集成
├── options.html       # 设置页面
├── options.css        # 设置页面样式
├── options.js         # 设置页面逻辑
└── icons/             # 扩展图标
```

### 构建

这是一个纯 WebExtension，不需要构建步骤。只需按照安装部分所述加载扩展。

### 测试

1. 安装扩展（有关说明，请参阅安装部分）
2. 在设置中配置您的 API 密钥
3. 撰写测试电子邮件
4. 点击扩展图标以测试检查功能

## 故障排除

### "请在设置中配置您的 Gemini API 密钥"
- 转到扩展设置并输入您的 API 密钥
- 确保密钥已保存（您应该看到成功消息）

### "API 请求失败"或连接错误
- 验证您的 API 密钥是否正确
- 检查您的互联网连接
- 确保您没有超过 API 速率限制（免费版有限制）
- 尝试在设置页面测试连接

### 弹窗未出现
- 确保您在撰写窗口中（而不是 Thunderbird 主窗口）
- 尝试关闭并重新打开撰写窗口
- 检查 Thunderbird 错误控制台是否有任何错误

## 许可证

MIT 许可证 - 有关详细信息，请参阅 LICENSE 文件

## 贡献

欢迎贡献！请随时提交问题或拉取请求。

## 免责声明

此扩展与 Google 或 Mozilla 没有正式关联。使用风险自负。
