# 国际化（i18n）支持

[English](../en/I18N.md) | [日本語](../ja/I18N.md) | [Deutsch](../de/I18N.md) | [Français](../fr/I18N.md) | 简体中文

## 概述
Gemini Mail Review 插件现在支持国际化，自动以匹配 Thunderbird 语言设置的语言显示 UI。

## 支持的语言
- **English (en)** - 默认语言
- **Japanese (ja)** - 日本語対応
- **German (de)** - Deutsch-Unterstützung
- **French (fr)** - Support français
- **Simplified Chinese (zh_CN)** - 简体中文支持

## 功能
- 基于 Thunderbird 区域设置的自动语言检测
- 如果当前区域设置不受支持，则回退到英语
- 所有 UI 元素都已翻译，包括：
  - 扩展名称和描述
  - 选项页面（设置）
  - 弹出窗口界面（电子邮件审查）
  - 按钮、标签和消息
  - 错误消息和状态文本

## 实现细节

### 目录结构
```
_locales/
├── en/
│   └── messages.json    # 英语翻译
├── ja/
│   └── messages.json    # 日语翻译
├── de/
│   └── messages.json    # 德语翻译
├── fr/
│   └── messages.json    # 法语翻译
└── zh_CN/
    └── messages.json    # 简体中文翻译
```

### 工作原理
1. 该插件使用 WebExtension `browser.i18n` API
2. Thunderbird 自动检测其当前区域设置
3. 插件加载相应的 `messages.json` 文件
4. 所有 UI 文本在运行时被替换为本地化字符串
5. 如果区域设置不受支持，则使用英语作为默认语言

### 示例翻译

#### 扩展名称
- English: "Gemini Mail Review"
- Japanese: "Gemini メールレビュー"
- Chinese: "Gemini 邮件审查"

#### 选项页面标题
- English: "Gemini Mail Review Settings"
- Japanese: "Gemini メールレビュー 設定"
- Chinese: "Gemini 邮件审查设置"

#### 保存按钮
- English: "Save Settings"
- Japanese: "設定を保存"
- Chinese: "保存设置"

#### 错误消息
- English: "Please configure your Gemini API key in the settings."
- Japanese: "設定で Gemini API キーを設定してください。"
- Chinese: "请在设置中配置您的 Gemini API 密钥。"

#### 自定义提示模板
- English: "Custom Prompt Templates:"
- Japanese: "カスタムプロンプトテンプレート:"
- Chinese: "自定义提示模板："

#### 模板选择
- English: "Select Custom Prompt Template:"
- Japanese: "カスタムプロンプトテンプレートを選択:"
- Chinese: "选择自定义提示模板："

#### 模板名称
- English: "Template 1 Name:", "Template 2 Name:", "Template 3 Name:"
- Japanese: "テンプレート1の名前:", "テンプレート2の名前:", "テンプレート3の名前:"
- Chinese: "模板 1 名称："、"模板 2 名称："、"模板 3 名称："

## 如何测试

### 更改 Thunderbird 的语言
1. 打开 Thunderbird
2. 转到**设置** > **常规** > **语言**
3. 选择您的首选语言（英语、日语、中文等）
4. 重新启动 Thunderbird
5. 打开插件选项或弹出窗口 - 它将以所选语言显示

### 验证语言支持
1. 在 Thunderbird 中安装插件
2. 使用英语区域设置测试：
   - 将 Thunderbird 语言设置为英语
   - 重新启动 Thunderbird
   - 打开插件设置 - 应以英语显示
3. 使用日语区域设置测试：
   - 将 Thunderbird 语言设置为日语（日本語）
   - 重新启动 Thunderbird
   - 打开插件设置 - 应以日语显示

## 添加新语言

要添加对其他语言的支持：

1. 创建新的区域设置目录：
   ```bash
   mkdir -p _locales/{locale_code}/
   ```

2. 复制英语消息文件作为模板：
   ```bash
   cp _locales/en/messages.json _locales/{locale_code}/messages.json
   ```

3. 翻译新 `messages.json` 文件中的所有消息值：
   ```json
   {
     "extensionName": {
       "message": "您的翻译在此",
       "description": "Name of the extension"
     },
     ...
   }
   ```

4. 通过将 Thunderbird 设置为新区域设置来测试

### 示例：添加西班牙语支持
```bash
mkdir -p _locales/es/
cp _locales/en/messages.json _locales/es/messages.json
# 编辑 _locales/es/messages.json 并将所有 "message" 值翻译为西班牙语
```

## 技术细节

### 使用的 API
- `browser.i18n.getMessage(messageName)` - 获取本地化字符串
- `browser.i18n.getUILanguage()` - 获取当前区域设置（可选）

### 修改的文件
- `manifest.json` - 添加了 `default_locale` 和 i18n 占位符
- `options.html` - 向文本元素添加了 `data-i18n` 属性
- `options.js` - 添加了 `localizeUI()` 函数以加载本地化字符串
- `popup.html` - 向文本元素添加了 `data-i18n` 属性
- `popup.js` - 添加了 `localizeUI()` 函数以加载本地化字符串

### 本地化过程
1. 页面加载，HTML 包含英语文本作为后备
2. 在 `DOMContentLoaded` 时调用 `localizeUI()` 函数
3. 函数查询所有具有 `data-i18n` 属性的元素
4. 对于每个元素，使用 `browser.i18n.getMessage()` 获取本地化消息
5. 用本地化字符串更新元素的 `textContent` 或 `placeholder`

## 浏览器兼容性
- Thunderbird 102.0 及更高版本（完全支持）
- 所有现代 WebExtension 兼容浏览器（如果移植）

## 注意事项
- i18n 实现遵循 Mozilla 的 WebExtension 标准
- 所有字符串都以 JSON 格式存储，便于维护
- 该系统是可扩展的 - 可以在不更改代码的情况下添加新语言
- 后备机制确保插件始终工作，即使使用不受支持的区域设置
